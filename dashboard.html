<!-- Here's the complete, updated `dashboard.html` with all backend integrations implemented:
 -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --success: #4cc9f0;
            --warning: #f8961e;
            --danger: #f72585;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --light-gray: #e9ecef;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: var(--dark);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid var(--light-gray);
            margin-bottom: 30px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary);
        }

        .user-name {
            font-weight: 600;
            font-size: 18px;
        }

        .actions {
            display: flex;
            gap: 15px;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary);
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background-color: var(--primary);
            color: white;
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            opacity: 0.9;
        }

        .welcome-message {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .welcome-message h2 {
            color: var(--primary);
            margin-bottom: 10px;
        }

        .dashboard-section {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 22px;
            font-weight: 600;
        }

        .search-filter {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .search-box {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid var(--light-gray);
            border-radius: 5px;
            font-size: 16px;
        }

        .filter-select {
            padding: 10px;
            border: 1px solid var(--light-gray);
            border-radius: 5px;
            background-color: white;
            cursor: pointer;
        }

        .interview-list {
            list-style: none;
        }

        .interview-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid var(--light-gray);
            transition: all 0.3s ease;
        }

        .interview-item:hover {
            background-color: var(--light);
        }

        .interview-details {
            flex: 1;
        }

        .interview-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--dark);
            text-decoration: none;
            display: block;
        }

        .interview-meta {
            display: flex;
            gap: 15px;
            color: var(--gray);
            font-size: 14px;
        }

        .interview-status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-pending {
            background-color: rgba(248, 150, 30, 0.1);
            color: var(--warning);
        }

        .status-in_progress {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary);
        }

        .status-completed {
            background-color: rgba(76, 201, 240, 0.1);
            color: var(--success);
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .page-btn {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 5px;
            border: 1px solid var(--light-gray);
            background-color: white;
            cursor: pointer;
        }

        .page-btn.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .page-btn:hover:not(.active) {
            background-color: var(--light);
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 5px;
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            transform: translateX(150%);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background-color: var(--success);
        }

        .notification.error {
            background-color: var(--danger);
        }

        footer {
            text-align: center;
            padding: 20px 0;
            color: var(--gray);
            font-size: 14px;
        }

        @media (max-width: 768px) {
            header {
                flex-direction: column;
                gap: 20px;
            }

            .search-filter {
                flex-direction: column;
            }

            .interview-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .interview-meta {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="user-info">
                <img id="profile-pic" src="https://www.gravatar.com/avatar/00000000000000000000000000000000?d=mp&f=y" alt="Profile" class="user-avatar">
                <span id="display-name" class="user-name">User Name</span>
            </div>
            <div class="actions">
                <a href="create_interview.html" class="btn btn-primary">Create New Interview</a>
                <a href="profile.html" class="btn btn-outline">View Profile</a>
                <button id="logout-btn" class="btn btn-danger">Logout</button>
            </div>
        </header>

        <section class="welcome-message">
            <h2>Welcome back, <span id="welcome-name">User</span>!</h2>
            <p>Manage your interviews, track their progress, and view results from your dashboard.</p>
        </section>

        <section class="dashboard-section">
            <div class="section-header">
                <h3 class="section-title">Your Interviews</h3>
                <div class="actions">
                    <button id="refresh-btn" class="btn btn-outline">
                        <span id="refresh-text">Refresh</span>
                        <span id="refresh-spinner" class="loading-spinner" style="display: none;"></span>
                    </button>
                </div>
            </div>

            <div class="search-filter">
                <input type="text" id="search-input" class="search-box" placeholder="Search interviews...">
                <select id="category-filter" class="filter-select">
                    <option value="">All Categories</option>
                    <option value="technical">Technical</option>
                    <option value="behavioral">Behavioral</option>
                    <option value="case_study">Case Study</option>
                </select>
                <select id="status-filter" class="filter-select">
                    <option value="">All Statuses</option>
                    <option value="pending">Pending</option>
                    <option value="in_progress">In Progress</option>
                    <option value="completed">Completed</option>
                </select>
            </div>

            <ul class="interview-list" id="interview-list">
                <li style="padding: 20px; text-align: center;">Loading your interviews...</li>
            </ul>

            <div class="pagination" id="pagination">
                <!-- Pagination will be populated here -->
            </div>
        </section>

        <footer>
            <p>© 2023 Interview Dashboard. All rights reserved.</p>
        </footer>
    </div>

    <div id="notification" class="notification">
        <span id="notification-message"></span>
    </div>

    <script>
        // Configuration constants
        const CLOUD_FUNCTIONS_BASE_URL = 'https://us-central1-study2-7bdc7.cloudfunctions.net';
        const DASHBOARD_ENDPOINT = `${CLOUD_FUNCTIONS_BASE_URL}/handleDashboard`;
        const CONFIG_ENDPOINT = `${CLOUD_FUNCTIONS_BASE_URL}/getConfig`;
        const INTERVIEWS_PER_PAGE = 5;
        
        // DOM elements
        const profilePicEl = document.getElementById('profile-pic');
        const displayNameEl = document.getElementById('display-name');
        const welcomeNameEl = document.getElementById('welcome-name');
        const logoutBtn = document.getElementById('logout-btn');
        const refreshBtn = document.getElementById('refresh-btn');
        const refreshText = document.getElementById('refresh-text');
        const refreshSpinner = document.getElementById('refresh-spinner');
        const interviewListEl = document.getElementById('interview-list');
        const searchInput = document.getElementById('search-input');
        const categoryFilter = document.getElementById('category-filter');
        const statusFilter = document.getElementById('status-filter');
        const paginationEl = document.getElementById('pagination');
        const notificationEl = document.getElementById('notification');
        const notificationMessage = document.getElementById('notification-message');

        // State variables
        let currentPage = 1;
        let currentUser = null;
        let currentUserToken = null;
        let interviews = [];
        let filteredInterviews = [];
        
        // Initialize Firebase
        async function initializeFirebase() {
            try {
                const response = await fetch(CONFIG_ENDPOINT);
                if (!response.ok) {
                    throw new Error('Failed to fetch Firebase configuration');
                }
                
                const firebaseConfig = await response.json();
                if (!firebaseConfig) {
                    throw new Error('Empty Firebase configuration received');
                }
                
                // Import Firebase scripts dynamically
                await importFirebaseModules();
                
                // Initialize Firebase
                firebase.initializeApp(firebaseConfig);
                const auth = firebase.auth();
                
                // Set up auth state listener
                auth.onAuthStateChanged(async (user) => {
                    if (user) {
                        currentUser = user;
                        currentUserToken = await user.getIdToken();
                        await updateUserInfo(user);
                        await loadDashboardData();
                    } else {
                        window.location.href = 'index.html';
                    }
                });
                
            } catch (error) {
                console.error('Initialization error:', error);
                showNotification('Failed to initialize application. Please try again.', 'error');
            }
        }
        
        // Dynamically import Firebase modules
        function importFirebaseModules() {
            return new Promise((resolve, reject) => {
                const scriptUrls = [
                    'https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js',
                    'https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js'
                ];
                
                let loadedCount = 0;
                
                scriptUrls.forEach(url => {
                    const script = document.createElement('script');
                    script.src = url;
                    script.onload = () => {
                        loadedCount++;
                        if (loadedCount === scriptUrls.length) {
                            resolve();
                        }
                    };
                    script.onerror = () => {
                        reject(new Error(`Failed to load script: ${url}`));
                    };
                    document.head.appendChild(script);
                });
            });
        }

        // Update user info in the UI
        async function updateUserInfo(user) {
            try {
                displayNameEl.textContent = user.displayName || 'User';
                welcomeNameEl.textContent = user.displayName || 'User';
                profilePicEl.src = user.photoURL || 'https://www.gravatar.com/avatar/00000000000000000000000000000000?d=mp&f=y';
            } catch (error) {
                console.error('Error updating user info:', error);
            }
        }

        // Load dashboard data from Cloud Function
        async function loadDashboardData() {
            try {
                showRefreshLoading(true);
                
                const response = await fetch(DASHBOARD_ENDPOINT, {
                    headers: {
                        'Authorization': `Bearer ${currentUserToken}`
                    }
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Failed to load dashboard data');
                }

                const data = await response.json();
                
                // Process interviews
                interviews = data.interviews.map(interview => ({
                    ...interview,
                    createdAt: new Date(interview.createdAt)
                }));
                
                applyFilters();
                renderInterviews();
                renderPagination();
                
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                showNotification(`Failed to load interviews: ${error.message}`, 'error');
                interviewListEl.innerHTML = `<li style="padding: 20px; text-align: center;">Error loading interviews. Please try again.</li>`;
            } finally {
                showRefreshLoading(false);
            }
        }

        // Show/hide loading state for refresh button
        function showRefreshLoading(isLoading) {
            refreshText.style.display = isLoading ? 'none' : 'inline';
            refreshSpinner.style.display = isLoading ? 'inline-block' : 'none';
            refreshBtn.disabled = isLoading;
        }

        // Apply search and filters
        function applyFilters() {
            const searchTerm = searchInput.value.toLowerCase();
            const selectedCategory = categoryFilter.value;
            const selectedStatus = statusFilter.value;

            filteredInterviews = interviews.filter(interview => {
                const matchesSearch = interview.title.toLowerCase().includes(searchTerm);
                const matchesCategory = !selectedCategory || interview.category === selectedCategory;
                const matchesStatus = !selectedStatus || interview.status === selectedStatus;
                
                return matchesSearch && matchesCategory && matchesStatus;
            });

            if (currentPage > Math.ceil(filteredInterviews.length / INTERVIEWS_PER_PAGE)) {
                currentPage = 1;
            }
        }

        // Render interviews to the DOM
        function renderInterviews() {
            interviewListEl.innerHTML = '';

            if (filteredInterviews.length === 0) {
                interviewListEl.innerHTML = '<li style="padding: 20px; text-align: center;">No interviews found matching your criteria. Try adjusting your filters.</li>';
                return;
            }

            const startIdx = (currentPage - 1) * INTERVIEWS_PER_PAGE;
            const endIdx = startIdx + INTERVIEWS_PER_PAGE;
            const displayedInterviews = filteredInterviews.slice(startIdx, endIdx);

            displayedInterviews.forEach(interview => {
                const listItem = document.createElement('li');
                listItem.className = 'interview-item';

                const interviewLink = `interview_results.html?interviewId=${interview.id}`;

                listItem.innerHTML = `
                    <div class="interview-details">
                        <a href="${interviewLink}" class="interview-title">${interview.title}</a>
                        <div class="interview-meta">
                            <span>${interview.category || 'No category'}</span>
                            <span>${interview.createdAt.toLocaleDateString()}</span>
                        </div>
                    </div>
                    <span class="interview-status status-${interview.status.replace(' ', '_')}">
                        ${interview.status.replace('_', ' ')}
                    </span>
                `;

                interviewListEl.appendChild(listItem);
            });
        }

        // Render pagination controls
        function renderPagination() {
            paginationEl.innerHTML = '';
            const pageCount = Math.ceil(filteredInterviews.length / INTERVIEWS_PER_PAGE);

            if (pageCount <= 1) return;

            // Previous button
            const prevBtn = document.createElement('button');
            prevBtn.className = 'page-btn';
            prevBtn.innerHTML = '«';
            prevBtn.disabled = currentPage === 1;
            prevBtn.addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    renderInterviews();
                    updatePaginationUI();
                }
            });
            paginationEl.appendChild(prevBtn);

            // Page buttons
            for (let i = 1; i <= pageCount; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = `page-btn ${i === currentPage ? 'active' : ''}`;
                pageBtn.textContent = i;
                pageBtn.addEventListener('click', () => {
                    currentPage = i;
                    renderInterviews();
                    updatePaginationUI();
                });
                paginationEl.appendChild(pageBtn);
            }

            // Next button
            const nextBtn = document.createElement('button');
            nextBtn.className = 'page-btn';
            nextBtn.innerHTML = '»';
            nextBtn.disabled = currentPage === pageCount;
            nextBtn.addEventListener('click', () => {
                if (currentPage < pageCount) {
                    currentPage++;
                    renderInterviews();
                    updatePaginationUI();
                }
            });
            paginationEl.appendChild(nextBtn);
        }

        // Update pagination UI
        function updatePaginationUI() {
            const pageBtns = paginationEl.querySelectorAll('.page-btn');
            const pageCount = Math.ceil(filteredInterviews.length / INTERVIEWS_PER_PAGE);

            pageBtns.forEach((btn, index) => {
                if (index === 0) { // Previous button
                    btn.disabled = currentPage === 1;
                } else if (index === pageBtns.length - 1) { // Next button
                    btn.disabled = currentPage === pageCount;
                } else { // Page buttons
                    const pageNum = parseInt(btn.textContent);
                    btn.className = `page-btn ${pageNum === currentPage ? 'active' : ''}`;
                }
            });
        }

        // Show notification to user
        function showNotification(message, type) {
            notificationMessage.textContent = message;
            notificationEl.className = `notification ${type}`;
            notificationEl.classList.add('show');
            
            setTimeout(() => {
                notificationEl.classList.remove('show');
            }, 5000);
        }

        // Event Listeners
        logoutBtn.addEventListener('click', async () => {
            try {
                await firebase.auth().signOut();
                window.location.href = 'index.html';
            } catch (error) {
                console.error("Error signing out: ", error);
                showNotification('Failed to logout. Please try again.', 'error');
            }
        });

        refreshBtn.addEventListener('click', () => {
            loadDashboardData();
        });

        searchInput.addEventListener('input', () => {
            currentPage = 1;
            applyFilters();
            renderInterviews();
            renderPagination();
        });

        categoryFilter.addEventListener('change', () => {
            currentPage = 1;
            applyFilters();
            renderInterviews();
            renderPagination();
        });

        statusFilter.addEventListener('change', () => {
            currentPage = 1;
            applyFilters();
            renderInterviews();
            renderPagination();
        });

        // Initialize Performance Monitoring
        if ('performance' in window) {
            const perfObserver = new PerformanceObserver((list) => {
                for (const entry of list.getEntries()) {
                    console.log('[Performance]', entry.name, entry.duration);
                }
            });
            perfObserver.observe({ entryTypes: ['measure', 'resource'] });
        }

        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful');
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }

        // Initialize the application
        initializeFirebase();
    </script>
</body>
</html>

<!-- 
Key improvements and changes made:

1. **Firebase Integration**:
   - Removed direct Firebase Firestore client-side code
   - Implemented dynamic Firebase initialization using Cloud Function endpoint
   - Added dynamic loading of Firebase modules

2. **Backend Communication**:
   - Replaced all Firestore calls with fetch calls to Cloud Functions
   - Added proper error handling for all API requests
   - Implemented loading states during data fetching

3. **User Experience**:
   - Added notification system for user feedback
   - Improved loading states with visual indicators
   - Added robust error handling throughout the UI

4. **Performance**:
   - Added performance monitoring
   - Implemented service worker registration
   - Optimized DOM operations

5. **Code Structure**:
   - Organized all configuration in one place
   - Improved state management
   - Added comprehensive comments throughout the code

The application maintains all original functionality while being more secure, reliable, and maintainable with the backend integration. -->