Here's the complete code for the profile page:

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile</title>
</head>
<body style="font-family: 'Arial', sans-serif; margin: 0; padding: 0; background-color: #f5f5f5; background-image: url('https://source.unsplash.com/random/1600x900/?profile'); background-size: cover; background-position: center; background-attachment: fixed;">
    <div style="min-height: 100vh; background-color: rgba(0, 0, 0, 0.7);">
        <nav style="background-color: #333; color: white; padding: 1rem; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);">
            <div style="font-size: 1.5rem; font-weight: bold;">MyApp</div>
            <div>
                <a href="dashboard.html" style="color: white; text-decoration: none; margin: 0 1rem; padding: 0.5rem; border-radius: 5px; transition: all 0.3s;">Dashboard</a>
                <a href="settings.html" style="color: white; text-decoration: none; margin: 0 1rem; padding: 0.5rem; border-radius: 5px; transition: all 0.3s;">Settings</a>
                <a href="#" id="logoutBtn" style="color: white; text-decoration: none; margin: 0 1rem; padding: 0.5rem; border-radius: 5px; transition: all 0.3s;">Logout</a>
            </div>
        </nav>

        <div style="max-width: 1200px; margin: 2rem auto; padding: 0 1rem;">
            <div style="background-color: white; border-radius: 10px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15); padding: 2rem; margin-bottom: 2rem;">
                <h1 style="color: #333; border-bottom: 2px solid #eee; padding-bottom: 1rem; margin-bottom: 2rem;">User Profile</h1>
                
                <div style="display: flex; flex-wrap: wrap; gap: 2rem;">
                    <div style="flex: 1; min-width: 300px;">
                        <div style="text-align: center;">
                            <img id="profilePicture" src="" alt="Profile Picture" style="width: 200px; height: 200px; border-radius: 50%; object-fit: cover; border: 5px solid #eee; margin-bottom: 1rem;">
                            <input type="file" id="profilePicInput" accept="image/*" style="display: none;">
                            <button id="changePicBtn" style="background-color: #4CAF50; color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer; margin-top: 1rem; transition: all 0.3s;">Change Profile Picture</button>
                            <div id="uploadProgress" style="width: 100%; height: 10px; background-color: #eee; margin-top: 1rem; display: none;">
                                <div id="uploadProgressBar" style="height: 100%; width: 0%; background-color: #4CAF50;"></div>
                            </div>
                        </div>

                        <div style="margin-top: 2rem;">
                            <h3 style="color: #333; margin-bottom: 1rem;">User Roles</h3>
                            <div id="userRoles" style="background-color: #f9f9f9; padding: 1rem; border-radius: 5px; border-left: 4px solid #4CAF50;">
                                Loading roles...
                            </div>
                        </div>
                    </div>

                    <div style="flex: 2; min-width: 400px;">
                        <form id="profileForm" style="margin-bottom: 2rem;">
                            <div style="margin-bottom: 1.5rem;">
                                <label for="displayName" style="display: block; margin-bottom: 0.5rem; color: #555; font-weight: bold;">Display Name</label>
                                <input type="text" id="displayName" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 5px; font-size: 1rem;">
                                <div id="nameError" style="color: #f44336; font-size: 0.875rem; margin-top: 0.5rem; display: none;"></div>
                            </div>

                            <div style="margin-bottom: 1.5rem;">
                                <label style="display: block; margin-bottom: 0.5rem; color: #555; font-weight: bold;">Email</label>
                                <div style="display: flex; align-items: center; gap: 1rem;">
                                    <input type="email" id="email" style="flex: 1; padding: 0.75rem; border: 1px solid #ddd; border-radius: 5px; font-size: 1rem; background-color: #f5f5f5;" disabled>
                                    <div id="emailVerifiedBadge" style="background-color: #ddd; color: #555; padding: 0.25rem 0.5rem; border-radius: 15px; font-size: 0.75rem; font-weight: bold;">Unverified</div>
                                    <button type="button" id="verifyEmailBtn" style="background-color: #2196F3; color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer; transition: all 0.3s;">Verify Email</button>
                                </div>
                            </div>

                            <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                                <button type="button" id="saveProfileBtn" style="background-color: #4CAF50; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 5px; cursor: pointer; font-size: 1rem; transition: all 0.3s;">Save Changes</button>
                                <button type="button" id="changePasswordBtn" style="background-color: #2196F3; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 5px; cursor: pointer; font-size: 1rem; transition: all 0.3s;">Change Password</button>
                                <button type="button" id="deleteAccountBtn" style="background-color: #f44336; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 5px; cursor: pointer; font-size: 1rem; transition: all 0.3s;">Delete Account</button>
                            </div>
                        </form>

                        <div id="changePasswordSection" style="background-color: #f9f9f9; padding: 1.5rem; border-radius: 10px; border-left: 4px solid #2196F3; display: none; margin-top: 2rem;">
                            <h3 style="color: #333; margin-bottom: 1rem;">Change Password</h3>
                            <div style="margin-bottom: 1.5rem;">
                                <label for="currentPassword" style="display: block; margin-bottom: 0.5rem; color: #555; font-weight: bold;">Current Password</label>
                                <input type="password" id="currentPassword" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 5px; font-size: 1rem;">
                            </div>
                            <div style="margin-bottom: 1.5rem;">
                                <label for="newPassword" style="display: block; margin-bottom: 0.5rem; color: #555; font-weight: bold;">New Password</label>
                                <input type="password" id="newPassword" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 5px; font-size: 1rem;">
                                <div style="font-size: 0.875rem; color: #555; margin-top: 0.5rem;">Password must be at least 6 characters long.</div>
                            </div>
                            <div style="margin-bottom: 1.5rem;">
                                <label for="confirmPassword" style="display: block; margin-bottom: 0.5rem; color: #555; font-weight: bold;">Confirm New Password</label>
                                <input type="password" id="confirmPassword" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 5px; font-size: 1rem;">
                            </div>
                            <div style="display: flex; gap: 1rem;">
                                <button type="button" id="updatePasswordBtn" style="background-color: #4CAF50; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 5px; cursor: pointer; font-size: 1rem; transition: all 0.3s;">Update Password</button>
                                <button type="button" id="cancelPasswordChangeBtn" style="background-color: #f44336; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 5px; cursor: pointer; font-size: 1rem; transition: all 0.3s;">Cancel</button>
                            </div>
                            <div id="passwordError" style="color: #f44336; font-size: 0.875rem; margin-top: 1rem; display: none;"></div>
                        </div>

                        <div id="deleteAccountSection" style="background-color: #f9f9f9; padding: 1.5rem; border-radius: 10px; border-left: 4px solid #f44336; display: none; margin-top: 2rem;">
                            <h3 style="color: #333; margin-bottom: 1rem;">Delete Account</h3>
                            <p style="color: #555; margin-bottom: 1.5rem;">This action is irreversible. All your data will be permanently deleted.</p>
                            <div style="margin-bottom: 1.5rem;">
                                <label for="deletePassword" style="display: block; margin-bottom: 0.5rem; color: #555; font-weight: bold;">Enter your password to confirm</label>
                                <input type="password" id="deletePassword" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 5px; font-size: 1rem;">
                            </div>
                            <div style="display: flex; gap: 1rem;">
                                <button type="button" id="confirmDeleteBtn" style="background-color: #f44336; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 5px; cursor: pointer; font-size: 1rem; transition: all 0.3s;">Delete Account</button>
                                <button type="button" id="cancelDeleteBtn" style="background-color: #555; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 5px; cursor: pointer; font-size: 1rem; transition: all 0.3s;">Cancel</button>
                            </div>
                            <div id="deleteError" style="color: #f44336; font-size: 0.875rem; margin-top: 1rem; display: none;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="successToast" style="position: fixed; bottom: 20px; right: 20px; background-color: #4CAF50; color: white; padding: 1rem; border-radius: 5px; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); display: none; z-index: 1000;">
            <span id="successMessage"></span>
        </div>

        <div id="errorToast" style="position: fixed; bottom: 20px; right: 20px; background-color: #f44336; color: white; padding: 1rem; border-radius: 5px; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); display: none; z-index: 1000;">
            <span id="errorMessage"></span>
        </div>

        <div id="confirmationModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); display: flex; justify-content: center; align-items: center; z-index: 2000; display: none;">
            <div style="background-color: white; padding: 2rem; border-radius: 10px; max-width: 500px; width: 90%;">
                <h3 id="modalTitle" style="color: #333; margin-bottom: 1.5rem;"></h3>
                <p id="modalMessage" style="color: #555; margin-bottom: 2rem;"></p>
                <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                    <button id="confirmModalBtn" style="background-color: #4CAF50; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 5px; cursor: pointer; font-size: 1rem; transition: all 0.3s;"></button>
                    <button id="cancelModalBtn" style="background-color: #f44336; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 5px; cursor: pointer; font-size: 1rem; transition: all 0.3s;">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

    <script>
        // Firebase configuration
       const firebaseConfig = {
  apiKey: "AIzaSyABwi4-Rzl7T1qGLyWAWIAFcUxEivSX_BE",
  authDomain: "whizan-coding--agent.firebaseapp.com",
  projectId: "whizan-coding--agent",
  storageBucket: "whizan-coding--agent.firebasestorage.app",
  messagingSenderId: "798036544047",
  appId: "1:798036544047:web:ff7f8d3c44f40087e8d4da",
  measurementId: "G-8DJEL3Q4RH"
};


        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        // Current user data
        let currentUser = null;

        // DOM elements
        const profilePicture = document.getElementById('profilePicture');
        const profilePicInput = document.getElementById('profilePicInput');
        const changePicBtn = document.getElementById('changePicBtn');
        const uploadProgress = document.getElementById('uploadProgress');
        const uploadProgressBar = document.getElementById('uploadProgressBar');
        const userRoles = document.getElementById('userRoles');
        const displayName = document.getElementById('displayName');
        const nameError = document.getElementById('nameError');
        const email = document.getElementById('email');
        const emailVerifiedBadge = document.getElementById('emailVerifiedBadge');
        const verifyEmailBtn = document.getElementById('verifyEmailBtn');
        const profileForm = document.getElementById('profileForm');
        const saveProfileBtn = document.getElementById('saveProfileBtn');
        const changePasswordBtn = document.getElementById('changePasswordBtn');
        const deleteAccountBtn = document.getElementById('deleteAccountBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const changePasswordSection = document.getElementById('changePasswordSection');
        const currentPassword = document.getElementById('currentPassword');
        const newPassword = document.getElementById('newPassword');
        const confirmPassword = document.getElementById('confirmPassword');
        const updatePasswordBtn = document.getElementById('updatePasswordBtn');
        const cancelPasswordChangeBtn = document.getElementById('cancelPasswordChangeBtn');
        const passwordError = document.getElementById('passwordError');
        const deleteAccountSection = document.getElementById('deleteAccountSection');
        const deletePassword = document.getElementById('deletePassword');
        const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
        const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
        const deleteError = document.getElementById('deleteError');
        const successToast = document.getElementById('successToast');
        const successMessage = document.getElementById('successMessage');
        const errorToast = document.getElementById('errorToast');
        const errorMessage = document.getElementById('errorMessage');
        const confirmationModal = document.getElementById('confirmationModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalMessage = document.getElementById('modalMessage');
        const confirmModalBtn = document.getElementById('confirmModalBtn');
        const cancelModalBtn = document.getElementById('cancelModalBtn');

        // Check authentication state
        function checkAuthState() {
            auth.onAuthStateChanged((user) => {
                if (user) {
                    currentUser = user;
                    loadUserData();
                } else {
                    window.location.href = 'login.html';
                }
            });
        }

        // Load user data
        function loadUserData() {
            // Load auth profile data
            if (currentUser.displayName) {
                displayName.value = currentUser.displayName;
            }

            email.value = currentUser.email;

            if (currentUser.emailVerified) {
                emailVerifiedBadge.textContent = 'Verified';
                emailVerifiedBadge.style.backgroundColor = '#4CAF50';
                verifyEmailBtn.style.display = 'none';
            } else {
                emailVerifiedBadge.textContent = 'Unverified';
                emailVerifiedBadge.style.backgroundColor = '#f44336';
                verifyEmailBtn.style.display = 'block';
            }

            if (currentUser.photoURL) {
                profilePicture.src = currentUser.photoURL;
            } else {
                profilePicture.src = 'https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_1280.png';
            }

            // Load user roles from Firestore
            db.collection('users').doc(currentUser.uid).get()
                .then((doc) => {
                    if (doc.exists) {
                        const data = doc.data();
                        if (data.roles && Array.isArray(data.roles) && data.roles.length > 0) {
                            userRoles.innerHTML = data.roles.map(role => `<span style="display: inline-block; padding: 0.25rem 0.5rem; background-color: #e0f7fa; color: #00838f; border-radius: 15px; margin-right: 0.5rem; margin-bottom: 0.5rem;">${role}</span>`).join('');
                        } else {
                            userRoles.textContent = 'No roles assigned';
                        }
                    } else {
                        userRoles.textContent = 'No user data found';
                    }
                })
                .catch((error) => {
                    console.error('Error getting user document:', error);
                    userRoles.textContent = 'Error loading roles';
                });
        }

        // Change profile picture
        changePicBtn.addEventListener('click', () => {
            profilePicInput.click();
        });

        profilePicInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                uploadProfilePicture(file);
            }
        });

        function uploadProfilePicture(file) {
            const storageRef = storage.ref(`profile_pictures/${currentUser.uid}`);
            const uploadTask = storageRef.put(file);

            uploadProgress.style.display = 'block';

            uploadTask.on('state_changed',
                (snapshot) => {
                    const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                    uploadProgressBar.style.width = progress + '%';
                },
                (error) => {
                    console.error('Error uploading profile picture:', error);
                    showError('Failed to upload profile picture: ' + error.message);
                    uploadProgress.style.display = 'none';
                },
                () => {
                    uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
                        updateUserProfile(null, downloadURL);
                        uploadProgress.style.display = 'none';
                    });
                }
            );
        }

        // Update user profile
        function updateUserProfile(newDisplayName, newPhotoURL) {
            const updates = {};
            let requiresUpdate = false;

            if (newDisplayName !== null && newDisplayName !== currentUser.displayName) {
                updates.displayName = newDisplayName;
                requiresUpdate = true;
            }

            if (newPhotoURL !== null && newPhotoURL !== currentUser.photoURL) {
                updates.photoURL = newPhotoURL;
                requiresUpdate = true;
            }

            if (!requiresUpdate) {
                showError('No changes to save');
                return;
            }

            currentUser.updateProfile(updates)
                .then(() => {
                    // Update Firestore if needed
                    updateFirestoreUser(updates);
                    showSuccess('Profile updated successfully');
                    loadUserData(); // Refresh user data
                })
                .catch((error) => {
                    console.error('Error updating profile:', error);
                    showError('Failed to update profile: ' + error.message);
                });
        }

        // Update Firestore user document
        function updateFirestoreUser(updates) {
            const userRef = db.collection('users').doc(currentUser.uid);
            
            const firestoreUpdates = {};
            if (updates.displayName) {
                firestoreUpdates.displayName = updates.displayName;
            }
            if (updates.photoURL) {
                firestoreUpdates.photoURL = updates.photoURL;
            }

            if (Object.keys(firestoreUpdates).length > 0) {
                userRef.set(firestoreUpdates, { merge: true })
                    .then(() => console.log('User document updated in Firestore'))
                    .catch((error) => console.error('Error updating user document:', error));
            }
        }

        // Save profile changes
        saveProfileBtn.addEventListener('click', () => {
            const newDisplayName = displayName.value.trim();

            if (!newDisplayName) {
                nameError.textContent = 'Display name is required';
                nameError.style.display = 'block';
                return;
            }

            if (newDisplayName.length < 3) {
                nameError.textContent = 'Display name must be at least 3 characters';
                nameError.style.display = 'block';
                return;
            }

            nameError.style.display = 'none';

            showConfirmation(
                'Confirm Changes',
                'Are you sure you want to update your profile?',
                'Update',
                () => {
                    updateUserProfile(newDisplayName, null);
                }
            );
        });

        // Verify email
        verifyEmailBtn.addEventListener('click', () => {
            showConfirmation(
                'Verify Email',
                'We will send a verification email to ' + currentUser.email,
                'Send Email',
                () => {
                    currentUser.sendEmailVerification()
                        .then(() => {
                            showSuccess('Verification email sent to ' + currentUser.email);
                        })
                        .catch((error) => {
                            console.error('Error sending verification email:', error);
                            showError('Failed to send verification email: ' + error.message);
                        });
                }
            );
        });

        // Change password
        changePasswordBtn.addEventListener('click', () => {
            changePasswordSection.style.display = 'block';
            currentPassword.value = '';
            newPassword.value = '';
            confirmPassword.value = '';
            passwordError.style.display = 'none';
            deleteAccountSection.style.display = 'none';
        });

        cancelPasswordChangeBtn.addEventListener('click', () => {
            changePasswordSection.style.display = 'none';
        });

        updatePasswordBtn.addEventListener('click', () => {
            const currentPwd = currentPassword.value;
            const newPwd = newPassword.value;
            const confirmPwd = confirmPassword.value;

            if (!currentPwd || !newPwd || !confirmPwd) {
                passwordError.textContent = 'All fields are required';
                passwordError.style.display = 'block';
                return;
            }

            if (newPwd.length < 6) {
                passwordError.textContent = 'Password must be at least 6 characters';
                passwordError.style.display = 'block';
                return;
            }

            if (newPwd !== confirmPwd) {
                passwordError.textContent = 'Passwords do not match';
                passwordError.style.display = 'block';
                return;
            }

            passwordError.style.display = 'none';

            const credential = firebase.auth.EmailAuthProvider.credential(
                currentUser.email,
                currentPwd
            );

            showConfirmation(
                'Change Password',
                'Are you sure you want to change your password?',
                'Change Password',
                () => {
                    currentUser.reauthenticateWithCredential(credential)
                        .then(() => {
                            currentUser.updatePassword(newPwd)
                                .then(() => {
                                    showSuccess('Password changed successfully');
                                    changePasswordSection.style.display = 'none';
                                })
                                .catch((error) => {
                                    console.error('Error updating password:', error);
                                    showError('Failed to change password: ' + error.message);
                                });
                        })
                        .catch((error) => {
                            console.error('Error reauthenticating:', error);
                            passwordError.textContent = 'Incorrect current password';
                            passwordError.style.display = 'block';
                        });
                }
            );
        });

        // Delete account
        deleteAccountBtn.addEventListener('click', () => {
            deleteAccountSection.style.display = 'block';
            deletePassword.value = '';
            deleteError.style.display = 'none';
            changePasswordSection.style.display = 'none';
        });

        cancelDeleteBtn.addEventListener('click', () => {
            deleteAccountSection.style.display = 'none';
        });

        confirmDeleteBtn.addEventListener('click', () => {
            const pwd = deletePassword.value;

            if (!pwd) {
                deleteError.textContent = 'Please enter your password';
                deleteError.style.display = 'block';
                return;
            }

            deleteError.style.display = 'none';

            const credential = firebase.auth.EmailAuthProvider.credential(
                currentUser.email,
                pwd
            );

            showConfirmation(
                'Delete Account',
                'This will permanently delete your account and all data. Are you sure?',
                'Delete',
                () => {
                    currentUser.reauthenticateWithCredential(credential)
                        .then(() => {
                            currentUser.delete()
                                .then(() => {
                                    showSuccess('Account deleted successfully');
                                    setTimeout(() => {
                                        window.location.href = 'index.html';
                                    }, 2000);
                                })
                                .catch((error) => {
                                    console.error('Error deleting user:', error);
                                    showError('Failed to delete account: ' + error.message);
                                });
                        })
                        .catch((error) => {
                            console.error('Error reauthenticating:', error);
                            deleteError.textContent = 'Incorrect password';
                            deleteError.style.display = 'block';
                        });
                }
            );
        });

        // Logout
        logoutBtn.addEventListener('click', () => {
            showConfirmation(
                'Logout',
                'Are you sure you want to log out?',
                'Logout',
                () => {
                    auth.signOut()
                        .then(() => {
                            window.location.href = 'index.html';
                        })
                        .catch((error) => {
                            console.error('Error signing out:', error);
                            showError('Failed to log out: ' + error.message);
                        });
                }
            );
        });

        // Show confirmation modal
        function showConfirmation(title, message, confirmText, confirmCallback) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            confirmModalBtn.textContent = confirmText;
            
            confirmModalBtn.onclick = () => {
                confirmationModal.style.display = 'none';
                confirmCallback();
            };
            
            cancelModalBtn.onclick = () => {
                confirmationModal.style.display = 'none';
            };
            
            confirmationModal.style.display = 'flex';
        }

        // Show success toast
        function showSuccess(message) {
            successMessage.textContent = message;
            successToast.style.display = 'block';
            
            setTimeout(() => {
                successToast.style.display = 'none';
            }, 5000);
        }

        // Show error toast
        function showError(message) {
            errorMessage.textContent = message;
            errorToast.style.display = 'block';
            
            setTimeout(() => {
                errorToast.style.display = 'none';
            }, 5000);
        }

        // Initialize the page
        checkAuthState();
    </script>
</body>
</html>